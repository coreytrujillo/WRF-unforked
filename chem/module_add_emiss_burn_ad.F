!        Generated by TAPENADE     (INRIA, Tropics team)
!  Tapenade 3.6 (r4756) - 12 Feb 2013 10:43
!
MODULE a_module_add_emiss_burn
  IMPLICIT NONE

CONTAINS
!  Differentiation of add_emis_burn in reverse (adjoint) mode (with options r8 noISIZE):
!   gradient     of useful results: scalebb rho_phy chem dz8w
!   with respect to varying inputs: scalebb rho_phy chem dz8w
  SUBROUTINE a_add_emis_burn(id, dtstep, ktau, dz8w, a_dz8w, rho_phy, &
&    a_rho_phy, chem, a_chem, julday, gmt, xlat, xlong, t_phy, p_phy, ebu&
&    , chem_opt, tracer_opt, biomass_burn_opt, scalebb, a_scalebb, &
&    scale_burn_opt, num_c, ids, ide, jds, jde, kds, kde, ims, ime, jms, &
&    jme, kms, kme, its, ite, jts, jte, kts, kte)
    USE module_configure, only: grid_config_rec_type
    USE module_state_description
    IMPLICIT NONE
    INTEGER, INTENT(IN) :: id, julday, chem_opt, biomass_burn_opt, num_c&
&    , ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, its, &
&    ite, jts, jte, kts, kte, tracer_opt
    INTEGER, INTENT(IN) :: ktau
    REAL, DIMENSION(ims:ime, kms:kme, jms:jme, num_c), INTENT(INOUT) :: &
&    chem
    REAL, DIMENSION(ims:ime, kms:kme, jms:jme, num_c), INTENT(INOUT) :: &
&    a_chem
    REAL, DIMENSION(ims:ime, kms:kme, jms:jme, num_ebu), INTENT(IN) :: &
&    ebu
    REAL, DIMENSION(ims:ime, jms:jme, num_scalebb), INTENT(IN) :: &
&    scalebb
    REAL, DIMENSION(ims:ime, jms:jme, num_scalebb) :: a_scalebb
    INTEGER, INTENT(IN) :: scale_burn_opt
    REAL, DIMENSION(ims:ime, jms:jme), INTENT(IN) :: xlat, xlong
    REAL, DIMENSION(ims:ime, kms:kme, jms:jme), INTENT(IN) :: t_phy, &
&    p_phy, dz8w, rho_phy
    REAL, DIMENSION(ims:ime, kms:kme, jms:jme) :: a_dz8w, a_rho_phy
    REAL, INTENT(IN) :: dtstep, gmt
    INTEGER :: imonth1, idate1, iyear1, itime1
    INTEGER :: i, j, k
    REAL :: time, conv_rho
    REAL :: a_conv_rho
    INTEGER :: iweek, idays
    REAL :: tign, timeq, r_q, r_antro
    REAL, DIMENSION(7) :: week_cycle
    REAL, PARAMETER :: bx_bburn=18.041288*3600., cx=2.184936*3600., &
&    rinti=2.1813936e-8, ax=2000.6038, bx_antro=15.041288*3600.
    INTEGER :: branch
    REAL :: temp3
    REAL :: temp20b0
    REAL :: temp17b4
    REAL :: temp25b18
    REAL :: temp29
    REAL :: temp2
    REAL :: temp17b3
    REAL :: temp25b17
    REAL :: temp28
    REAL :: temp1
    REAL :: temp13b
    REAL :: temp17b2
    REAL :: temp25b16
    REAL :: temp27
    REAL :: temp0
    REAL :: temp17b1
    REAL :: temp25b15
    REAL :: temp26
    REAL :: temp17b0
    REAL :: temp25b14
    REAL :: temp23b16
    REAL :: temp25
    REAL :: temp23b15
    REAL :: temp24
    REAL :: temp25b13
    REAL :: temp23b14
    REAL :: temp23
    REAL :: temp25b12
    REAL :: temp32b1
    REAL :: temp22
    REAL :: temp23b13
    REAL :: temp25b11
    REAL :: temp32b0
    REAL :: temp21
    REAL :: temp23b12
    REAL :: temp25b10
    REAL :: temp26b
    REAL :: temp12b0
    REAL :: temp20
    REAL :: temp23b11
    REAL :: temp23b10
    REAL :: temp14b
    REAL :: temp1b
    REAL :: temp6b0
    REAL :: temp15b
    REAL :: temp1b0
    REAL :: temp28b
    REAL :: temp11b3
    REAL :: temp11b2
    REAL :: temp23b9
    REAL :: temp11b1
    REAL :: temp23b8
    REAL :: temp11b0
    REAL :: temp23b7
    REAL :: temp3b
    REAL :: temp19
    REAL :: temp23b6
    REAL :: temp5b9
    REAL :: temp18
    REAL :: temp23b5
    REAL :: temp28b0
    REAL :: temp5b8
    REAL :: temp17
    REAL :: temp23b4
    REAL :: temp30b
    REAL :: temp5b7
    REAL :: temp16
    REAL :: temp23b3
    REAL :: temp5b6
    REAL :: temp15
    REAL :: temp23b2
    REAL :: temp5b5
    REAL :: temp14
    REAL :: temp23b1
    REAL :: temp5b4
    REAL :: temp13
    REAL :: temp23b0
    REAL :: temp5b3
    REAL :: temp12
    REAL :: temp17b
    REAL :: temp5b2
    REAL :: temp11
    REAL :: temp5b1
    REAL :: temp10
    REAL :: temp5b0
    REAL :: temp18b
    REAL :: temp9b9
    REAL :: temp5b
    REAL :: temp9b8
    REAL :: temp30b0
    REAL :: temp9b7
    REAL :: temp9b6
    REAL :: temp32b
    REAL :: temp9b5
    REAL :: temp9b4
    REAL :: temp9b3
    REAL :: temp9b18
    REAL :: temp20b
    REAL :: temp9b2
    REAL :: temp9b17
    REAL :: temp9b1
    REAL :: temp9b16
    REAL :: temp19b
    REAL :: temp17b20
    REAL :: temp5b19
    REAL :: temp9b0
    REAL :: temp9b15
    REAL :: temp6b
    REAL :: temp5b18
    REAL :: temp9b14
    REAL :: temp5b17
    REAL :: temp9b13
    REAL :: temp5b16
    REAL :: temp9b12
    REAL :: temp5b15
    REAL :: temp9b11
    REAL :: temp5b14
    REAL :: temp9b10
    REAL :: temp19b0
    REAL :: temp5b13
    REAL :: temp21b
    REAL :: temp5b12
    REAL :: temp5b11
    REAL :: temp5b10
    REAL :: temp7b
    REAL :: temp14b0
    REAL :: temp25b26
    REAL :: temp26b3
    REAL :: tempb
    REAL :: temp25b25
    REAL :: temp26b2
    REAL :: temp25b24
    REAL :: temp26b1
    REAL :: temp25b23
    REAL :: temp26b0
    REAL :: temp25b22
    REAL :: temp25b21
    REAL :: temp25b20
    REAL :: temp31
    REAL :: temp17b19
    REAL :: temp30
    REAL :: temp17b18
    REAL :: temp17b17
    REAL :: temp17b16
    REAL :: temp23b
    REAL :: temp3b1
    REAL :: temp17b15
    REAL :: temp3b0
    REAL :: temp18b0
    REAL :: temp17b14
    REAL :: temp11b
    REAL :: temp17b13
    REAL :: temp9b
    REAL :: temp17b12
    REAL :: temp17b11
    REAL :: temp25b9
    REAL :: temp17b10
    REAL :: temp25b8
    REAL :: temp13b0
    REAL :: temp25b7
    REAL :: temp25b6
    REAL :: temp25b5
    REAL :: temp
    REAL :: temp25b4
    REAL :: temp25b3
    REAL :: temp12b
    REAL :: temp25b2
    REAL :: temp9
    REAL :: temp25b1
    REAL :: temp8
    REAL :: temp17b9
    REAL :: temp25b0
    REAL :: temp7
    REAL :: temp17b8
    REAL :: temp6
    REAL :: temp17b7
    REAL :: temp5
    REAL :: temp17b6
    REAL :: temp4
    REAL :: temp17b5
    REAL :: temp25b
    REAL :: temp25b19
    DATA (week_cycle(iweek), iweek=1,7) /0.67, 1.1, 1.1, 1.1, 1.1, 1.1, &
&         0.83/
    r_q = 1.
    SELECT CASE  (tracer_opt) 
    CASE (TRACER_SMOKE) 
      CALL PUSHCONTROL2B(0)
    CASE (TRACER_TEST2) 
      CALL PUSHCONTROL2B(1)
    CASE DEFAULT
      CALL PUSHCONTROL2B(2)
    END SELECT
    SELECT CASE  (chem_opt) 
    CASE (RACMPM_KPP) 
      DO j=jte,jts,-1
        DO i=ite,its,-1
          DO k=kte,kts,-1
            temp5b11 = ebu(i, k, j, p_ebu_so2)*a_chem(i, k, j, p_so2)
            temp5b10 = ebu(i, k, j, p_ebu_sulf)*a_chem(i, k, j, p_sulf&
&              )
            temp5b12 = ebu(i, k, j, p_ebu_csl)*a_chem(i, k, j, p_csl)
            temp5b9 = ebu(i, k, j, p_ebu_iso)*a_chem(i, k, j, p_iso)
            temp5b13 = ebu(i, k, j, p_ebu_no)*a_chem(i, k, j, p_no)
            temp5b8 = ebu(i, k, j, p_ebu_no2)*a_chem(i, k, j, p_no2)
            temp5b14 = ebu(i, k, j, p_ebu_ald)*a_chem(i, k, j, p_ald)
            temp5b7 = ebu(i, k, j, p_ebu_hcho)*a_chem(i, k, j, p_hcho)
            temp5b15 = ebu(i, k, j, p_ebu_ora2)*a_chem(i, k, j, p_ora2&
&              )
            temp5b6 = ebu(i, k, j, p_ebu_hc3)*a_chem(i, k, j, p_hc3)
            temp5b16 = ebu(i, k, j, p_ebu_hc5)*a_chem(i, k, j, p_hc5)
            temp5b5 = ebu(i, k, j, p_ebu_hc8)*a_chem(i, k, j, p_hc8)
            temp5b17 = ebu(i, k, j, p_ebu_eth)*a_chem(i, k, j, p_eth)
            temp5b4 = ebu(i, k, j, p_ebu_co)*a_chem(i, k, j, p_co)
            temp5b18 = ebu(i, k, j, p_ebu_olt)*a_chem(i, k, j, p_olt)
            temp5b3 = ebu(i, k, j, p_ebu_oli)*a_chem(i, k, j, p_oli)
            temp5b19 = ebu(i, k, j, p_ebu_tol)*a_chem(i, k, j, p_tol)
            temp5b2 = ebu(i, k, j, p_ebu_xyl)*a_chem(i, k, j, p_xyl)
            temp5b1 = ebu(i, k, j, p_ebu_ket)*a_chem(i, k, j, p_ket)
            a_conv_rho = scalebb(i, j, p_scbb_xyl)*temp5b2 + scalebb(i&
&              , j, p_scbb_oli)*temp5b3 + scalebb(i, j, p_scbb_co)*&
&              temp5b4 + scalebb(i, j, p_scbb_hc8)*temp5b5 + scalebb(&
&              i, j, p_scbb_hc3)*temp5b6 + scalebb(i, j, p_scbb_hcho)*&
&              temp5b7 + scalebb(i, j, p_scbb_no2)*temp5b8 + scalebb(&
&              i, j, p_scbb_iso)*temp5b9 + scalebb(i, j, p_scbb_sulf)*&
&              temp5b10 + scalebb(i, j, p_scbb_so2)*temp5b11 + &
&              scalebb(i, j, p_scbb_csl)*temp5b12 + scalebb(i, j, &
&              p_scbb_no)*temp5b13 + scalebb(i, j, p_scbb_ald)*&
&              temp5b14 + scalebb(i, j, p_scbb_ora2)*temp5b15 + &
&              scalebb(i, j, p_scbb_hc5)*temp5b16 + scalebb(i, j, &
&              p_scbb_eth)*temp5b17 + scalebb(i, j, p_scbb_olt)*&
&              temp5b18 + scalebb(i, j, p_scbb_tol)*temp5b19 + &
&              scalebb(i, j, p_scbb_ket)*temp5b1
            temp4 = 60.*rho_phy(i, k, j)
            temp3 = temp4*dz8w(i, k, j)
            temp3b1 = -(r_q*4.828e-4*dtstep*a_conv_rho/temp3**2)
            temp5 = rho_phy(i, k, j)*dz8w(i, k, j)
            temp5b0 = ebu(i, k, j, p_ebu_pm25)*r_q*dtstep*a_chem(i, k&
&              , j, p_pm_25)/temp5
            temp5b = -(scalebb(i, j, p_scbb_pm25)*temp5b0/temp5)
            temp6 = rho_phy(i, k, j)*dz8w(i, k, j)
            temp6b = ebu(i, k, j, p_ebu_pm10)*r_q*dtstep*a_chem(i, k, &
&              j, p_pm_10)/temp6
            temp6b0 = -(scalebb(i, j, p_scbb_pm10)*temp6b/temp6)
            a_scalebb(i, j, p_scbb_pm10) = a_scalebb(i, j, p_scbb_pm10) &
&              + temp6b
            a_rho_phy(i, k, j) = a_rho_phy(i, k, j) + dz8w(i, k, j)*&
&              temp5b + dz8w(i, k, j)*60.*temp3b1 + dz8w(i, k, j)*&
&              temp6b0
            a_dz8w(i, k, j) = a_dz8w(i, k, j) + rho_phy(i, k, j)*&
&              temp5b + temp4*temp3b1 + rho_phy(i, k, j)*temp6b0
            a_scalebb(i, j, p_scbb_pm25) = a_scalebb(i, j, p_scbb_pm25) &
&              + temp5b0
            conv_rho = r_q*4.828e-4/rho_phy(i, k, j)*dtstep/(dz8w(i, k, &
&              j)*60.)
            a_scalebb(i, j, p_scbb_ket) = a_scalebb(i, j, p_scbb_ket) + &
&              conv_rho*temp5b1
            a_scalebb(i, j, p_scbb_xyl) = a_scalebb(i, j, p_scbb_xyl) + &
&              conv_rho*temp5b2
            a_scalebb(i, j, p_scbb_tol) = a_scalebb(i, j, p_scbb_tol) + &
&              conv_rho*temp5b19
            a_scalebb(i, j, p_scbb_oli) = a_scalebb(i, j, p_scbb_oli) + &
&              conv_rho*temp5b3
            a_scalebb(i, j, p_scbb_olt) = a_scalebb(i, j, p_scbb_olt) + &
&              conv_rho*temp5b18
            a_scalebb(i, j, p_scbb_co) = a_scalebb(i, j, p_scbb_co) + &
&              conv_rho*temp5b4
            a_scalebb(i, j, p_scbb_eth) = a_scalebb(i, j, p_scbb_eth) + &
&              conv_rho*temp5b17
            a_scalebb(i, j, p_scbb_hc8) = a_scalebb(i, j, p_scbb_hc8) + &
&              conv_rho*temp5b5
            a_scalebb(i, j, p_scbb_hc5) = a_scalebb(i, j, p_scbb_hc5) + &
&              conv_rho*temp5b16
            a_scalebb(i, j, p_scbb_hc3) = a_scalebb(i, j, p_scbb_hc3) + &
&              conv_rho*temp5b6
            a_scalebb(i, j, p_scbb_ora2) = a_scalebb(i, j, p_scbb_ora2) &
&              + conv_rho*temp5b15
            a_scalebb(i, j, p_scbb_hcho) = a_scalebb(i, j, p_scbb_hcho) &
&              + conv_rho*temp5b7
            a_scalebb(i, j, p_scbb_ald) = a_scalebb(i, j, p_scbb_ald) + &
&              conv_rho*temp5b14
            a_scalebb(i, j, p_scbb_no2) = a_scalebb(i, j, p_scbb_no2) + &
&              conv_rho*temp5b8
            a_scalebb(i, j, p_scbb_no) = a_scalebb(i, j, p_scbb_no) + &
&              conv_rho*temp5b13
            a_scalebb(i, j, p_scbb_iso) = a_scalebb(i, j, p_scbb_iso) + &
&              conv_rho*temp5b9
            a_scalebb(i, j, p_scbb_csl) = a_scalebb(i, j, p_scbb_csl) + &
&              conv_rho*temp5b12
            a_scalebb(i, j, p_scbb_sulf) = a_scalebb(i, j, p_scbb_sulf) &
&              + conv_rho*temp5b10
            a_scalebb(i, j, p_scbb_so2) = a_scalebb(i, j, p_scbb_so2) + &
&              conv_rho*temp5b11
          END DO
        END DO
      END DO
    CASE (RADM2SORG, RACMSORG_KPP, RADM2SORG_KPP, RACM_ESRLSORG_KPP, &
&    racm_soa_vbs_kpp, radm2sorg_aq, radm2sorg_aqchem, racmsorg_aq, &
&    racmsorg_aqchem_kpp) 
      DO j=jte,jts,-1
        DO i=ite,its,-1
          DO k=kte,kts,-1
            temp9b9 = ebu(i, k, j, p_ebu_so2)*a_chem(i, k, j, p_so2)
            temp9b8 = ebu(i, k, j, p_ebu_sulf)*a_chem(i, k, j, p_sulf)
            temp9b10 = ebu(i, k, j, p_ebu_csl)*a_chem(i, k, j, p_csl)
            temp9b7 = ebu(i, k, j, p_ebu_iso)*a_chem(i, k, j, p_iso)
            temp9b11 = ebu(i, k, j, p_ebu_no)*a_chem(i, k, j, p_no)
            temp9b6 = ebu(i, k, j, p_ebu_no2)*a_chem(i, k, j, p_no2)
            temp9b12 = ebu(i, k, j, p_ebu_ald)*a_chem(i, k, j, p_ald)
            temp9b5 = ebu(i, k, j, p_ebu_hcho)*a_chem(i, k, j, p_hcho)
            temp9b13 = ebu(i, k, j, p_ebu_ora2)*a_chem(i, k, j, p_ora2&
&              )
            temp9b4 = ebu(i, k, j, p_ebu_hc3)*a_chem(i, k, j, p_hc3)
            temp9b14 = ebu(i, k, j, p_ebu_hc5)*a_chem(i, k, j, p_hc5)
            temp9b3 = ebu(i, k, j, p_ebu_hc8)*a_chem(i, k, j, p_hc8)
            temp9b15 = ebu(i, k, j, p_ebu_eth)*a_chem(i, k, j, p_eth)
            temp9b2 = ebu(i, k, j, p_ebu_co)*a_chem(i, k, j, p_co)
            temp9b16 = ebu(i, k, j, p_ebu_olt)*a_chem(i, k, j, p_olt)
            temp9b1 = ebu(i, k, j, p_ebu_oli)*a_chem(i, k, j, p_oli)
            temp9b17 = ebu(i, k, j, p_ebu_tol)*a_chem(i, k, j, p_tol)
            temp9b0 = ebu(i, k, j, p_ebu_xyl)*a_chem(i, k, j, p_xyl)
            conv_rho = r_q*4.828e-4/rho_phy(i, k, j)*dtstep/60./dz8w(i, &
&              k, j)
            temp9b = ebu(i, k, j, p_ebu_ket)*a_chem(i, k, j, p_ket)
            a_scalebb(i, j, p_scbb_ket) = a_scalebb(i, j, p_scbb_ket) + &
&              conv_rho*temp9b
            a_conv_rho = scalebb(i, j, p_scbb_xyl)*temp9b0 + scalebb(i&
&              , j, p_scbb_oli)*temp9b1 + scalebb(i, j, p_scbb_co)*&
&              temp9b2 + scalebb(i, j, p_scbb_hc8)*temp9b3 + scalebb(&
&              i, j, p_scbb_hc3)*temp9b4 + scalebb(i, j, p_scbb_hcho)*&
&              temp9b5 + scalebb(i, j, p_scbb_no2)*temp9b6 + scalebb(&
&              i, j, p_scbb_iso)*temp9b7 + scalebb(i, j, p_scbb_sulf)*&
&              temp9b8 + scalebb(i, j, p_scbb_so2)*temp9b9 + scalebb(&
&              i, j, p_scbb_csl)*temp9b10 + scalebb(i, j, p_scbb_no)*&
&              temp9b11 + scalebb(i, j, p_scbb_ald)*temp9b12 + &
&              scalebb(i, j, p_scbb_ora2)*temp9b13 + scalebb(i, j, &
&              p_scbb_hc5)*temp9b14 + scalebb(i, j, p_scbb_eth)*&
&              temp9b15 + scalebb(i, j, p_scbb_olt)*temp9b16 + &
&              scalebb(i, j, p_scbb_tol)*temp9b17 + scalebb(i, j, &
&              p_scbb_ket)*temp9b
            a_scalebb(i, j, p_scbb_xyl) = a_scalebb(i, j, p_scbb_xyl) + &
&              conv_rho*temp9b0
            a_scalebb(i, j, p_scbb_tol) = a_scalebb(i, j, p_scbb_tol) + &
&              conv_rho*temp9b17
            a_scalebb(i, j, p_scbb_oli) = a_scalebb(i, j, p_scbb_oli) + &
&              conv_rho*temp9b1
            a_scalebb(i, j, p_scbb_olt) = a_scalebb(i, j, p_scbb_olt) + &
&              conv_rho*temp9b16
            a_scalebb(i, j, p_scbb_co) = a_scalebb(i, j, p_scbb_co) + &
&              conv_rho*temp9b2
            a_scalebb(i, j, p_scbb_eth) = a_scalebb(i, j, p_scbb_eth) + &
&              conv_rho*temp9b15
            a_scalebb(i, j, p_scbb_hc8) = a_scalebb(i, j, p_scbb_hc8) + &
&              conv_rho*temp9b3
            a_scalebb(i, j, p_scbb_hc5) = a_scalebb(i, j, p_scbb_hc5) + &
&              conv_rho*temp9b14
            a_scalebb(i, j, p_scbb_hc3) = a_scalebb(i, j, p_scbb_hc3) + &
&              conv_rho*temp9b4
            a_scalebb(i, j, p_scbb_ora2) = a_scalebb(i, j, p_scbb_ora2) &
&              + conv_rho*temp9b13
            a_scalebb(i, j, p_scbb_hcho) = a_scalebb(i, j, p_scbb_hcho) &
&              + conv_rho*temp9b5
            a_scalebb(i, j, p_scbb_ald) = a_scalebb(i, j, p_scbb_ald) + &
&              conv_rho*temp9b12
            a_scalebb(i, j, p_scbb_no2) = a_scalebb(i, j, p_scbb_no2) + &
&              conv_rho*temp9b6
            a_scalebb(i, j, p_scbb_no) = a_scalebb(i, j, p_scbb_no) + &
&              conv_rho*temp9b11
            a_scalebb(i, j, p_scbb_iso) = a_scalebb(i, j, p_scbb_iso) + &
&              conv_rho*temp9b7
            a_scalebb(i, j, p_scbb_csl) = a_scalebb(i, j, p_scbb_csl) + &
&              conv_rho*temp9b10
            a_scalebb(i, j, p_scbb_sulf) = a_scalebb(i, j, p_scbb_sulf) &
&              + conv_rho*temp9b8
            a_scalebb(i, j, p_scbb_so2) = a_scalebb(i, j, p_scbb_so2) + &
&              conv_rho*temp9b9
            temp8 = 60.*rho_phy(i, k, j)
            temp7 = temp8*dz8w(i, k, j)
            temp7b = -(r_q*4.828e-4*dtstep*a_conv_rho/temp7**2)
            a_rho_phy(i, k, j) = a_rho_phy(i, k, j) + dz8w(i, k, j)*60.*&
&              temp7b
            a_dz8w(i, k, j) = a_dz8w(i, k, j) + temp8*temp7b
          END DO
        END DO
      END DO
    CASE (GOCART_SIMPLE) 
      DO j=jte,jts,-1
        DO i=ite,its,-1
          DO k=kte,kts,-1
            temp11b3 = ebu(i, k, j, p_ebu_so2)*a_chem(i, k, j, p_so2)
            temp11b2 = ebu(i, k, j, p_ebu_sulf)*a_chem(i, k, j, p_sulf&
&              )
            temp11b1 = ebu(i, k, j, p_ebu_dms)*a_chem(i, k, j, p_dms)
            a_conv_rho = scalebb(i, j, p_scbb_sulf)*temp11b2 + scalebb&
&              (i, j, p_scbb_so2)*temp11b3 + scalebb(i, j, p_scbb_dms)*&
&              temp11b1
            temp10 = 60.*rho_phy(i, k, j)
            temp9 = temp10*dz8w(i, k, j)
            temp9b18 = -(r_q*4.828e-4*dtstep*a_conv_rho/temp9**2)
            temp11 = rho_phy(i, k, j)*dz8w(i, k, j)
            temp11b0 = ebu(i, k, j, p_ebu_oc)*r_q*dtstep*a_chem(i, k, &
&              j, p_oc1)/temp11
            temp11b = -(scalebb(i, j, p_scbb_oc)*temp11b0/temp11)
            temp12 = rho_phy(i, k, j)*dz8w(i, k, j)
            temp12b0 = ebu(i, k, j, p_ebu_bc)*r_q*dtstep*a_chem(i, k, &
&              j, p_bc1)/temp12
            temp12b = -(scalebb(i, j, p_scbb_bc)*temp12b0/temp12)
            temp13 = rho_phy(i, k, j)*dz8w(i, k, j)
            temp13b0 = ebu(i, k, j, p_ebu_pm25)*r_q*dtstep*a_chem(i, k&
&              , j, p_p25)/temp13
            temp13b = -(scalebb(i, j, p_scbb_pm25)*temp13b0/temp13)
            temp14 = rho_phy(i, k, j)*dz8w(i, k, j)
            temp14b = ebu(i, k, j, p_ebu_pm10)*r_q*dtstep*a_chem(i, k&
&              , j, p_p10)/temp14
            temp14b0 = -(scalebb(i, j, p_scbb_pm10)*temp14b/temp14)
            a_scalebb(i, j, p_scbb_pm10) = a_scalebb(i, j, p_scbb_pm10) &
&              + temp14b
            a_rho_phy(i, k, j) = a_rho_phy(i, k, j) + dz8w(i, k, j)*&
&              temp13b + dz8w(i, k, j)*temp11b + dz8w(i, k, j)*60.*&
&              temp9b18 + dz8w(i, k, j)*temp12b + dz8w(i, k, j)*&
&              temp14b0
            a_dz8w(i, k, j) = a_dz8w(i, k, j) + rho_phy(i, k, j)*&
&              temp13b + rho_phy(i, k, j)*temp11b + temp10*temp9b18&
&              + rho_phy(i, k, j)*temp12b + rho_phy(i, k, j)*temp14b0
            a_scalebb(i, j, p_scbb_pm25) = a_scalebb(i, j, p_scbb_pm25) &
&              + temp13b0
            a_scalebb(i, j, p_scbb_bc) = a_scalebb(i, j, p_scbb_bc) + &
&              temp12b0
            a_scalebb(i, j, p_scbb_oc) = a_scalebb(i, j, p_scbb_oc) + &
&              temp11b0
            conv_rho = r_q*4.828e-4/rho_phy(i, k, j)*dtstep/(dz8w(i, k, &
&              j)*60.)
            a_scalebb(i, j, p_scbb_dms) = a_scalebb(i, j, p_scbb_dms) + &
&              conv_rho*temp11b1
            a_scalebb(i, j, p_scbb_sulf) = a_scalebb(i, j, p_scbb_sulf) &
&              + conv_rho*temp11b2
            a_scalebb(i, j, p_scbb_so2) = a_scalebb(i, j, p_scbb_so2) + &
&              conv_rho*temp11b3
          END DO
        END DO
      END DO
    CASE (GOCART_BCCO) 
      DO j=jte,jts,-1
        DO i=ite,its,-1
          DO k=kte,kts,-1
            temp5b4 = ebu(i, k, j, p_ebu_co)*a_chem(i, k, j, p_co)
            a_conv_rho =  scalebb(i, j, p_scbb_co)*temp5b4 
            temp4 = 60.*rho_phy(i, k, j)
            temp3 = temp4*dz8w(i, k, j)
            temp3b1 = -(r_q*4.828e-4*dtstep*a_conv_rho/temp3**2)
            temp12 = rho_phy(i, k, j)*dz8w(i, k, j)
            temp12b0 = ebu(i, k, j, p_ebu_bc)*r_q*dtstep*a_chem(i, k, &
&              j, p_bc1)/temp12
            temp12b = -(scalebb(i, j, p_scbb_bc)*temp12b0/temp12)
            a_dz8w(i, k, j) = a_dz8w(i, k, j) + temp4*temp3b1 + &
&              rho_phy(i, k, j)*temp12b
            a_rho_phy(i, k, j) = a_rho_phy(i, k, j) + dz8w(i, k, j)*60.*&
&              temp3b1 + dz8w(i, k, j)*temp12b
            a_scalebb(i, j, p_scbb_bc) = a_scalebb(i, j, p_scbb_bc) + &
&              temp12b0
            conv_rho = r_q*4.828e-4/rho_phy(i, k, j)*dtstep/(dz8w(i, k, &
&              j)*60.)
            a_scalebb(i, j, p_scbb_co) = a_scalebb(i, j, p_scbb_co) + &
&              conv_rho*temp5b4
          END DO
        END DO
      END DO
    CASE (GOCART_BC)
      DO j=jte,jts,-1
        DO i=ite,its,-1
          DO k=kte,kts,-1
            temp4 = 60.*rho_phy(i, k, j)
            temp3 = temp4*dz8w(i, k, j)
            temp12 = rho_phy(i, k, j)*dz8w(i, k, j)
            temp12b0 = ebu(i, k, j, p_ebu_bc)*r_q*dtstep*a_chem(i, k, &
&              j, p_bc1)/temp12
            temp12b = -(scalebb(i, j, p_scbb_bc)*temp12b0/temp12)
            a_dz8w(i, k, j) = a_dz8w(i, k, j) + rho_phy(i, k, j)*temp12b
            a_rho_phy(i, k, j) = a_rho_phy(i, k, j) + dz8w(i, k, j)*  &
&              temp12b
            a_scalebb(i, j, p_scbb_bc) = a_scalebb(i, j, p_scbb_bc) + &
&              temp12b0
          END DO
        END DO
      END DO
    CASE (GOCARTRACM_KPP, GOCARTRADM2) 
      DO j=jte,jts,-1
        DO i=ite,its,-1
          DO k=kte,kts,-1
            temp17b11 = ebu(i, k, j, p_ebu_so2)*a_chem(i, k, j, p_so2)
            temp17b12 = ebu(i, k, j, p_ebu_sulf)*a_chem(i, k, j, &
&              p_sulf)
            temp17b10 = ebu(i, k, j, p_ebu_dms)*a_chem(i, k, j, p_dms)
            temp17b13 = ebu(i, k, j, p_ebu_csl)*a_chem(i, k, j, p_csl)
            temp17b9 = ebu(i, k, j, p_ebu_iso)*a_chem(i, k, j, p_iso)
            temp17b14 = ebu(i, k, j, p_ebu_no)*a_chem(i, k, j, p_no)
            temp17b8 = ebu(i, k, j, p_ebu_no2)*a_chem(i, k, j, p_no2)
            temp17b15 = ebu(i, k, j, p_ebu_ald)*a_chem(i, k, j, p_ald)
            temp17b7 = ebu(i, k, j, p_ebu_hcho)*a_chem(i, k, j, p_hcho&
&              )
            temp17b16 = ebu(i, k, j, p_ebu_ora2)*a_chem(i, k, j, &
&              p_ora2)
            temp17b6 = ebu(i, k, j, p_ebu_hc3)*a_chem(i, k, j, p_hc3)
            temp17b17 = ebu(i, k, j, p_ebu_hc5)*a_chem(i, k, j, p_hc5)
            temp17b5 = ebu(i, k, j, p_ebu_hc8)*a_chem(i, k, j, p_hc8)
            temp17b18 = ebu(i, k, j, p_ebu_eth)*a_chem(i, k, j, p_eth)
            temp17b4 = ebu(i, k, j, p_ebu_co)*a_chem(i, k, j, p_co)
            temp17b19 = ebu(i, k, j, p_ebu_olt)*a_chem(i, k, j, p_olt)
            temp17b3 = ebu(i, k, j, p_ebu_oli)*a_chem(i, k, j, p_oli)
            temp17b20 = ebu(i, k, j, p_ebu_tol)*a_chem(i, k, j, p_tol)
            temp17b2 = ebu(i, k, j, p_ebu_xyl)*a_chem(i, k, j, p_xyl)
            temp17b1 = ebu(i, k, j, p_ebu_ket)*a_chem(i, k, j, p_ket)
            a_conv_rho = scalebb(i, j, p_scbb_xyl)*temp17b2 + scalebb(&
&              i, j, p_scbb_oli)*temp17b3 + scalebb(i, j, p_scbb_co)*&
&              temp17b4 + scalebb(i, j, p_scbb_hc8)*temp17b5 + &
&              scalebb(i, j, p_scbb_hc3)*temp17b6 + scalebb(i, j, &
&              p_scbb_hcho)*temp17b7 + scalebb(i, j, p_scbb_no2)*&
&              temp17b8 + scalebb(i, j, p_scbb_iso)*temp17b9 + &
&              scalebb(i, j, p_scbb_dms)*temp17b10 + scalebb(i, j, &
&              p_scbb_so2)*temp17b11 + scalebb(i, j, p_scbb_sulf)*&
&              temp17b12 + scalebb(i, j, p_scbb_csl)*temp17b13 + &
&              scalebb(i, j, p_scbb_no)*temp17b14 + scalebb(i, j, &
&              p_scbb_ald)*temp17b15 + scalebb(i, j, p_scbb_ora2)*&
&              temp17b16 + scalebb(i, j, p_scbb_hc5)*temp17b17 + &
&              scalebb(i, j, p_scbb_eth)*temp17b18 + scalebb(i, j, &
&              p_scbb_olt)*temp17b19 + scalebb(i, j, p_scbb_tol)*&
&              temp17b20 + scalebb(i, j, p_scbb_ket)*temp17b1
            temp16 = 60.*rho_phy(i, k, j)
            temp15 = temp16*dz8w(i, k, j)
            temp15b = -(r_q*4.828e-4*dtstep*a_conv_rho/temp15**2)
            temp17 = rho_phy(i, k, j)*dz8w(i, k, j)
            temp17b0 = ebu(i, k, j, p_ebu_oc)*r_q*dtstep*a_chem(i, k, &
&              j, p_oc1)/temp17
            temp17b = -(scalebb(i, j, p_scbb_oc)*temp17b0/temp17)
            temp18 = rho_phy(i, k, j)*dz8w(i, k, j)
            temp18b0 = ebu(i, k, j, p_ebu_bc)*r_q*dtstep*a_chem(i, k, &
&              j, p_bc1)/temp18
            temp18b = -(scalebb(i, j, p_scbb_bc)*temp18b0/temp18)
            temp19 = rho_phy(i, k, j)*dz8w(i, k, j)
            temp19b0 = ebu(i, k, j, p_ebu_pm25)*r_q*dtstep*a_chem(i, k&
&              , j, p_p25)/temp19
            temp19b = -(scalebb(i, j, p_scbb_pm25)*temp19b0/temp19)
            temp20 = rho_phy(i, k, j)*dz8w(i, k, j)
            temp20b = ebu(i, k, j, p_ebu_pm10)*r_q*dtstep*a_chem(i, k&
&              , j, p_p10)/temp20
            temp20b0 = -(scalebb(i, j, p_scbb_pm10)*temp20b/temp20)
            a_scalebb(i, j, p_scbb_pm10) = a_scalebb(i, j, p_scbb_pm10) &
&              + temp20b
            a_rho_phy(i, k, j) = a_rho_phy(i, k, j) + dz8w(i, k, j)*&
&              temp19b + dz8w(i, k, j)*temp17b + dz8w(i, k, j)*60.*&
&              temp15b + dz8w(i, k, j)*temp18b + dz8w(i, k, j)*&
&              temp20b0
            a_dz8w(i, k, j) = a_dz8w(i, k, j) + rho_phy(i, k, j)*&
&              temp19b + rho_phy(i, k, j)*temp17b + temp16*temp15b &
&              + rho_phy(i, k, j)*temp18b + rho_phy(i, k, j)*temp20b0
            a_scalebb(i, j, p_scbb_pm25) = a_scalebb(i, j, p_scbb_pm25) &
&              + temp19b0
            a_scalebb(i, j, p_scbb_bc) = a_scalebb(i, j, p_scbb_bc) + &
&              temp18b0
            a_scalebb(i, j, p_scbb_oc) = a_scalebb(i, j, p_scbb_oc) + &
&              temp17b0
            conv_rho = r_q*4.828e-4/rho_phy(i, k, j)*dtstep/(dz8w(i, k, &
&              j)*60.)
            a_scalebb(i, j, p_scbb_ket) = a_scalebb(i, j, p_scbb_ket) + &
&              conv_rho*temp17b1
            a_scalebb(i, j, p_scbb_xyl) = a_scalebb(i, j, p_scbb_xyl) + &
&              conv_rho*temp17b2
            a_scalebb(i, j, p_scbb_tol) = a_scalebb(i, j, p_scbb_tol) + &
&              conv_rho*temp17b20
            a_scalebb(i, j, p_scbb_oli) = a_scalebb(i, j, p_scbb_oli) + &
&              conv_rho*temp17b3
            a_scalebb(i, j, p_scbb_olt) = a_scalebb(i, j, p_scbb_olt) + &
&              conv_rho*temp17b19
            a_scalebb(i, j, p_scbb_co) = a_scalebb(i, j, p_scbb_co) + &
&              conv_rho*temp17b4
            a_scalebb(i, j, p_scbb_eth) = a_scalebb(i, j, p_scbb_eth) + &
&              conv_rho*temp17b18
            a_scalebb(i, j, p_scbb_hc8) = a_scalebb(i, j, p_scbb_hc8) + &
&              conv_rho*temp17b5
            a_scalebb(i, j, p_scbb_hc5) = a_scalebb(i, j, p_scbb_hc5) + &
&              conv_rho*temp17b17
            a_scalebb(i, j, p_scbb_hc3) = a_scalebb(i, j, p_scbb_hc3) + &
&              conv_rho*temp17b6
            a_scalebb(i, j, p_scbb_ora2) = a_scalebb(i, j, p_scbb_ora2) &
&              + conv_rho*temp17b16
            a_scalebb(i, j, p_scbb_hcho) = a_scalebb(i, j, p_scbb_hcho) &
&              + conv_rho*temp17b7
            a_scalebb(i, j, p_scbb_ald) = a_scalebb(i, j, p_scbb_ald) + &
&              conv_rho*temp17b15
            a_scalebb(i, j, p_scbb_no2) = a_scalebb(i, j, p_scbb_no2) + &
&              conv_rho*temp17b8
            a_scalebb(i, j, p_scbb_no) = a_scalebb(i, j, p_scbb_no) + &
&              conv_rho*temp17b14
            a_scalebb(i, j, p_scbb_iso) = a_scalebb(i, j, p_scbb_iso) + &
&              conv_rho*temp17b9
            a_scalebb(i, j, p_scbb_csl) = a_scalebb(i, j, p_scbb_csl) + &
&              conv_rho*temp17b13
            a_scalebb(i, j, p_scbb_dms) = a_scalebb(i, j, p_scbb_dms) + &
&              conv_rho*temp17b10
            a_scalebb(i, j, p_scbb_sulf) = a_scalebb(i, j, p_scbb_sulf) &
&              + conv_rho*temp17b12
            a_scalebb(i, j, p_scbb_so2) = a_scalebb(i, j, p_scbb_so2) + &
&              conv_rho*temp17b11
          END DO
        END DO
      END DO
    CASE (RADM2, RACM_KPP, RACM_MIM_KPP, SAPRC99_KPP, &
&    saprc99_mosaic_4bin_vbs2_kpp) 
      DO j=jte,jts,-1
        DO i=ite,its,-1
          DO k=kte,kts,-1
            temp23b8 = ebu(i, k, j, p_ebu_csl)*a_chem(i, k, j, p_csl)
            temp23b7 = ebu(i, k, j, p_ebu_iso)*a_chem(i, k, j, p_iso)
            temp23b9 = ebu(i, k, j, p_ebu_no)*a_chem(i, k, j, p_no)
            temp23b6 = ebu(i, k, j, p_ebu_no2)*a_chem(i, k, j, p_no2)
            temp23b10 = ebu(i, k, j, p_ebu_ald)*a_chem(i, k, j, p_ald)
            temp23b5 = ebu(i, k, j, p_ebu_hcho)*a_chem(i, k, j, p_hcho&
&              )
            temp23b11 = ebu(i, k, j, p_ebu_ora2)*a_chem(i, k, j, &
&              p_ora2)
            temp23b4 = ebu(i, k, j, p_ebu_hc3)*a_chem(i, k, j, p_hc3)
            temp23b12 = ebu(i, k, j, p_ebu_hc5)*a_chem(i, k, j, p_hc5)
            temp23b3 = ebu(i, k, j, p_ebu_hc8)*a_chem(i, k, j, p_hc8)
            temp23b13 = ebu(i, k, j, p_ebu_eth)*a_chem(i, k, j, p_eth)
            temp23b2 = ebu(i, k, j, p_ebu_co)*a_chem(i, k, j, p_co)
            temp23b14 = ebu(i, k, j, p_ebu_olt)*a_chem(i, k, j, p_olt)
            temp23b1 = ebu(i, k, j, p_ebu_oli)*a_chem(i, k, j, p_oli)
            temp23b15 = ebu(i, k, j, p_ebu_tol)*a_chem(i, k, j, p_tol)
            temp23b0 = ebu(i, k, j, p_ebu_xyl)*a_chem(i, k, j, p_xyl)
            conv_rho = r_q*4.828e-4/rho_phy(i, k, j)*dtstep/60./dz8w(i, &
&              k, j)
            temp23b = ebu(i, k, j, p_ebu_ket)*a_chem(i, k, j, p_ket)
            a_scalebb(i, j, p_scbb_ket) = a_scalebb(i, j, p_scbb_ket) + &
&              conv_rho*temp23b
            a_conv_rho = scalebb(i, j, p_scbb_xyl)*temp23b0 + scalebb(&
&              i, j, p_scbb_oli)*temp23b1 + scalebb(i, j, p_scbb_co)*&
&              temp23b2 + scalebb(i, j, p_scbb_hc8)*temp23b3 + &
&              scalebb(i, j, p_scbb_hc3)*temp23b4 + scalebb(i, j, &
&              p_scbb_hcho)*temp23b5 + scalebb(i, j, p_scbb_no2)*&
&              temp23b6 + scalebb(i, j, p_scbb_iso)*temp23b7 + &
&              scalebb(i, j, p_scbb_csl)*temp23b8 + scalebb(i, j, &
&              p_scbb_no)*temp23b9 + scalebb(i, j, p_scbb_ald)*&
&              temp23b10 + scalebb(i, j, p_scbb_ora2)*temp23b11 + &
&              scalebb(i, j, p_scbb_hc5)*temp23b12 + scalebb(i, j, &
&              p_scbb_eth)*temp23b13 + scalebb(i, j, p_scbb_olt)*&
&              temp23b14 + scalebb(i, j, p_scbb_tol)*temp23b15 + &
&              scalebb(i, j, p_scbb_ket)*temp23b
            a_scalebb(i, j, p_scbb_xyl) = a_scalebb(i, j, p_scbb_xyl) + &
&              conv_rho*temp23b0
            a_scalebb(i, j, p_scbb_tol) = a_scalebb(i, j, p_scbb_tol) + &
&              conv_rho*temp23b15
            a_scalebb(i, j, p_scbb_oli) = a_scalebb(i, j, p_scbb_oli) + &
&              conv_rho*temp23b1
            a_scalebb(i, j, p_scbb_olt) = a_scalebb(i, j, p_scbb_olt) + &
&              conv_rho*temp23b14
            a_scalebb(i, j, p_scbb_co) = a_scalebb(i, j, p_scbb_co) + &
&              conv_rho*temp23b2
            a_scalebb(i, j, p_scbb_eth) = a_scalebb(i, j, p_scbb_eth) + &
&              conv_rho*temp23b13
            a_scalebb(i, j, p_scbb_hc8) = a_scalebb(i, j, p_scbb_hc8) + &
&              conv_rho*temp23b3
            a_scalebb(i, j, p_scbb_hc5) = a_scalebb(i, j, p_scbb_hc5) + &
&              conv_rho*temp23b12
            a_scalebb(i, j, p_scbb_hc3) = a_scalebb(i, j, p_scbb_hc3) + &
&              conv_rho*temp23b4
            a_scalebb(i, j, p_scbb_ora2) = a_scalebb(i, j, p_scbb_ora2) &
&              + conv_rho*temp23b11
            a_scalebb(i, j, p_scbb_hcho) = a_scalebb(i, j, p_scbb_hcho) &
&              + conv_rho*temp23b5
            a_scalebb(i, j, p_scbb_ald) = a_scalebb(i, j, p_scbb_ald) + &
&              conv_rho*temp23b10
            a_scalebb(i, j, p_scbb_no2) = a_scalebb(i, j, p_scbb_no2) + &
&              conv_rho*temp23b6
            a_scalebb(i, j, p_scbb_no) = a_scalebb(i, j, p_scbb_no) + &
&              conv_rho*temp23b9
            a_scalebb(i, j, p_scbb_iso) = a_scalebb(i, j, p_scbb_iso) + &
&              conv_rho*temp23b7
            a_scalebb(i, j, p_scbb_csl) = a_scalebb(i, j, p_scbb_csl) + &
&              conv_rho*temp23b8
            temp22 = 60.*rho_phy(i, k, j)
            temp21 = temp22*dz8w(i, k, j)
            temp21b = -(r_q*4.828e-4*dtstep*a_conv_rho/temp21**2)
            a_rho_phy(i, k, j) = a_rho_phy(i, k, j) + dz8w(i, k, j)*60.*&
&              temp21b
            a_dz8w(i, k, j) = a_dz8w(i, k, j) + temp22*temp21b
          END DO
        END DO
      END DO
    CASE (MOZART_KPP,MOZCART_KPP,MOZART_MOSAIC_4BIN_KPP, MOZART_MOSAIC_4BIN_AQ_KPP )
      IF (biomass_burn_opt .EQ. biomassb_mozc .OR. biomass_burn_opt .EQ.&
&          biomassb_moz) THEN
        IF (biomass_burn_opt .EQ. biomassb_mozc) THEN
          DO j=jte,jts,-1
            DO k=kte,kts,-1
              DO i=ite,its,-1
                temp26b1 = ebu(i, k, j, p_ebu_oc)*a_chem(i, k, j, &
&                  p_oc1)
                temp26b2 = ebu(i, k, j, p_ebu_bc)*a_chem(i, k, j, &
&                  p_bc1)
                temp26b0 = ebu(i, k, j, p_ebu_pm10)*a_chem(i, k, j, &
&                  p_p10)
                conv_rho = r_q*dtstep/(rho_phy(i, k, j)*dz8w(i, k, j))
                temp26b = ebu(i, k, j, p_ebu_pm25)*a_chem(i, k, j, &
&                  p_p25)
                a_scalebb(i, j, p_scbb_pm25) = a_scalebb(i, j, &
&                  p_scbb_pm25) + conv_rho*temp26b
                a_conv_rho = scalebb(i, j, p_scbb_pm10)*temp26b0 + &
&                  scalebb(i, j, p_scbb_oc)*temp26b1 + scalebb(i, j, &
&                  p_scbb_bc)*temp26b2 + scalebb(i, j, p_scbb_pm25)*&
&                  temp26b
                a_scalebb(i, j, p_scbb_pm10) = a_scalebb(i, j, &
&                  p_scbb_pm10) + conv_rho*temp26b0
                a_scalebb(i, j, p_scbb_bc) = a_scalebb(i, j, p_scbb_bc) &
&                  + conv_rho*temp26b2
                a_scalebb(i, j, p_scbb_oc) = a_scalebb(i, j, p_scbb_oc) &
&                  + conv_rho*temp26b1
                temp25 = rho_phy(i, k, j)*dz8w(i, k, j)
                temp25b26 = -(r_q*dtstep*a_conv_rho/temp25**2)
                a_rho_phy(i, k, j) = a_rho_phy(i, k, j) + dz8w(i, k, j)*&
&                  temp25b26
                a_dz8w(i, k, j) = a_dz8w(i, k, j) + rho_phy(i, k, j)*&
&                  temp25b26
              END DO
            END DO
          END DO
        END IF
        DO j=jte,jts,-1
          DO k=kte,kts,-1
            DO i=ite,its,-1
              temp25b13 = ebu(i, k, j, p_ebu_co)*a_chem(i, k, j, p_co)
              temp25b12 = ebu(i, k, j, p_ebu_no)*a_chem(i, k, j, p_no)
              temp25b14 = ebu(i, k, j, p_ebu_no2)*a_chem(i, k, j, &
&                p_no2)
              temp25b11 = ebu(i, k, j, p_ebu_bigalk)*a_chem(i, k, j, &
&                p_bigalk)
              temp25b15 = ebu(i, k, j, p_ebu_bigene)*a_chem(i, k, j, &
&                p_bigene)
              temp25b10 = ebu(i, k, j, p_ebu_c2h4)*a_chem(i, k, j, &
&                p_c2h4)
              temp25b16 = ebu(i, k, j, p_ebu_c2h5oh)*a_chem(i, k, j, &
&                p_c2h5oh)
              temp25b9 = ebu(i, k, j, p_ebu_c2h6)*a_chem(i, k, j, &
&                p_c2h6)
              temp25b17 = ebu(i, k, j, p_ebu_c3h6)*a_chem(i, k, j, &
&                p_c3h6)
              temp25b8 = ebu(i, k, j, p_ebu_c3h8)*a_chem(i, k, j, &
&                p_c3h8)
              temp25b18 = ebu(i, k, j, p_ebu_ch2o)*a_chem(i, k, j, &
&                p_hcho)
              temp25b7 = ebu(i, k, j, p_ebu_ch3cho)*a_chem(i, k, j, &
&                p_ald)
              temp25b19 = ebu(i, k, j, p_ebu_acetol)*a_chem(i, k, j, &
&                p_acetol)
              temp25b6 = ebu(i, k, j, p_ebu_isop)*a_chem(i, k, j, &
&                p_isopr)
              temp25b20 = ebu(i, k, j, p_ebu_macr)*a_chem(i, k, j, &
&                p_macr)
              temp25b5 = ebu(i, k, j, p_ebu_mvk)*a_chem(i, k, j, p_mvk&
&                )
              temp25b21 = ebu(i, k, j, p_ebu_ch3coch3)*a_chem(i, k, j&
&                , p_acet)
              temp25b4 = ebu(i, k, j, p_ebu_ch3oh)*a_chem(i, k, j, &
&                p_ch3oh)
              temp25b22 = ebu(i, k, j, p_ebu_mek)*a_chem(i, k, j, &
&                p_mek)
              temp25b3 = ebu(i, k, j, p_ebu_so2)*a_chem(i, k, j, p_so2&
&                )
              temp25b23 = ebu(i, k, j, p_ebu_toluene)*a_chem(i, k, j, &
&                p_tol)
              temp25b2 = ebu(i, k, j, p_ebu_nh3)*a_chem(i, k, j, p_nh3&
&                )
              temp25b24 = ebu(i, k, j, p_ebu_open)*a_chem(i, k, j, &
&                p_open)
              temp25b1 = ebu(i, k, j, p_ebu_c10h16)*a_chem(i, k, j, &
&                p_c10h16)
              temp25b25 = ebu(i, k, j, p_ebu_cres)*a_chem(i, k, j, &
&                p_cres)
              temp25b0 = ebu(i, k, j, p_ebu_glyald)*a_chem(i, k, j, &
&                p_glyald)
              conv_rho = r_q*4.828e-4*dtstep/(rho_phy(i, k, j)*60.*dz8w(&
&                i, k, j))
              temp25b = ebu(i, k, j, p_ebu_gly)*a_chem(i, k, j, p_gly)
              a_scalebb(i, j, p_scbb_gly) = a_scalebb(i, j, p_scbb_gly) &
&                + conv_rho*temp25b
              a_conv_rho = scalebb(i, j, p_scbb_glyald)*temp25b0 + &
&                scalebb(i, j, p_scbb_c10h16)*temp25b1 + scalebb(i, j, &
&                p_scbb_nh3)*temp25b2 + scalebb(i, j, p_scbb_so2)*&
&                temp25b3 + scalebb(i, j, p_scbb_ch3oh)*temp25b4 + &
&                scalebb(i, j, p_scbb_mvk)*temp25b5 + scalebb(i, j, &
&                p_scbb_isop)*temp25b6 + scalebb(i, j, p_scbb_ch3cho)*&
&                temp25b7 + scalebb(i, j, p_scbb_c3h8)*temp25b8 + &
&                scalebb(i, j, p_scbb_c2h6)*temp25b9 + scalebb(i, j, &
&                p_scbb_c2h4)*temp25b10 + scalebb(i, j, p_scbb_bigalk)*&
&                temp25b11 + scalebb(i, j, p_scbb_no)*temp25b12 + &
&                scalebb(i, j, p_scbb_co)*temp25b13 + scalebb(i, j, &
&                p_scbb_no2)*temp25b14 + scalebb(i, j, p_scbb_bigene)*&
&                temp25b15 + scalebb(i, j, p_scbb_c2h5oh)*temp25b16 +&
&                scalebb(i, j, p_scbb_c3h6)*temp25b17 + scalebb(i, j, &
&                p_scbb_ch2o)*temp25b18 + scalebb(i, j, p_scbb_acetol)*&
&                temp25b19 + scalebb(i, j, p_scbb_macr)*temp25b20 + &
&                scalebb(i, j, p_scbb_ch3coch3)*temp25b21 + scalebb(i, &
&                j, p_scbb_mek)*temp25b22 + scalebb(i, j, &
&                p_scbb_toluene)*temp25b23 + scalebb(i, j, p_scbb_open)&
&                *temp25b24 + scalebb(i, j, p_scbb_cres)*temp25b25 + &
&                scalebb(i, j, p_scbb_gly)*temp25b
              a_scalebb(i, j, p_scbb_glyald) = a_scalebb(i, j, &
&                p_scbb_glyald) + conv_rho*temp25b0
              a_scalebb(i, j, p_scbb_cres) = a_scalebb(i, j, p_scbb_cres&
&                ) + conv_rho*temp25b25
              a_scalebb(i, j, p_scbb_c10h16) = a_scalebb(i, j, &
&                p_scbb_c10h16) + conv_rho*temp25b1
              a_scalebb(i, j, p_scbb_open) = a_scalebb(i, j, p_scbb_open&
&                ) + conv_rho*temp25b24
              a_scalebb(i, j, p_scbb_nh3) = a_scalebb(i, j, p_scbb_nh3) &
&                + conv_rho*temp25b2
              a_scalebb(i, j, p_scbb_toluene) = a_scalebb(i, j, &
&                p_scbb_toluene) + conv_rho*temp25b23
              a_scalebb(i, j, p_scbb_so2) = a_scalebb(i, j, p_scbb_so2) &
&                + conv_rho*temp25b3
              a_scalebb(i, j, p_scbb_mek) = a_scalebb(i, j, p_scbb_mek) &
&                + conv_rho*temp25b22
              a_scalebb(i, j, p_scbb_ch3oh) = a_scalebb(i, j, &
&                p_scbb_ch3oh) + conv_rho*temp25b4
              a_scalebb(i, j, p_scbb_ch3coch3) = a_scalebb(i, j, &
&                p_scbb_ch3coch3) + conv_rho*temp25b21
              a_scalebb(i, j, p_scbb_mvk) = a_scalebb(i, j, p_scbb_mvk) &
&                + conv_rho*temp25b5
              a_scalebb(i, j, p_scbb_macr) = a_scalebb(i, j, p_scbb_macr&
&                ) + conv_rho*temp25b20
              a_scalebb(i, j, p_scbb_isop) = a_scalebb(i, j, p_scbb_isop&
&                ) + conv_rho*temp25b6
              a_scalebb(i, j, p_scbb_acetol) = a_scalebb(i, j, &
&                p_scbb_acetol) + conv_rho*temp25b19
              a_scalebb(i, j, p_scbb_ch3cho) = a_scalebb(i, j, &
&                p_scbb_ch3cho) + conv_rho*temp25b7
              a_scalebb(i, j, p_scbb_ch2o) = a_scalebb(i, j, p_scbb_ch2o&
&                ) + conv_rho*temp25b18
              a_scalebb(i, j, p_scbb_c3h8) = a_scalebb(i, j, p_scbb_c3h8&
&                ) + conv_rho*temp25b8
              a_scalebb(i, j, p_scbb_c3h6) = a_scalebb(i, j, p_scbb_c3h6&
&                ) + conv_rho*temp25b17
              a_scalebb(i, j, p_scbb_c2h6) = a_scalebb(i, j, p_scbb_c2h6&
&                ) + conv_rho*temp25b9
              a_scalebb(i, j, p_scbb_c2h5oh) = a_scalebb(i, j, &
&                p_scbb_c2h5oh) + conv_rho*temp25b16
              a_scalebb(i, j, p_scbb_c2h4) = a_scalebb(i, j, p_scbb_c2h4&
&                ) + conv_rho*temp25b10
              a_scalebb(i, j, p_scbb_bigene) = a_scalebb(i, j, &
&                p_scbb_bigene) + conv_rho*temp25b15
              a_scalebb(i, j, p_scbb_bigalk) = a_scalebb(i, j, &
&                p_scbb_bigalk) + conv_rho*temp25b11
              a_scalebb(i, j, p_scbb_no2) = a_scalebb(i, j, p_scbb_no2) &
&                + conv_rho*temp25b14
              a_scalebb(i, j, p_scbb_no) = a_scalebb(i, j, p_scbb_no) + &
&                conv_rho*temp25b12
              a_scalebb(i, j, p_scbb_co) = a_scalebb(i, j, p_scbb_co) + &
&                conv_rho*temp25b13
              temp24 = 60.*rho_phy(i, k, j)
              temp23 = temp24*dz8w(i, k, j)
              temp23b16 = -(r_q*4.828e-4*dtstep*a_conv_rho/temp23**2)
              a_rho_phy(i, k, j) = a_rho_phy(i, k, j) + dz8w(i, k, j)*&
&                60.*temp23b16
              a_dz8w(i, k, j) = a_dz8w(i, k, j) + temp24*temp23b16
            END DO
          END DO
        END DO
      END IF
    CASE (CHEM_TRACE2) 
      DO j=jts,jte
        DO i=its,ite
          CALL PUSHINTEGER4(k)
        END DO
      END DO
      DO j=jte,jts,-1
        DO i=ite,its,-1
          k = kts
          conv_rho = r_q*4.828e-4/rho_phy(i, k, j)*dtstep/(dz8w(i, k, j)&
&            *60.)
          temp30b = ebu(i, k, j, p_ebu_co)*a_chem(i, k, j, p_tracer_1)
          a_scalebb(i, j, p_scbb_co) = a_scalebb(i, j, p_scbb_co) + &
&            conv_rho*temp30b
          a_conv_rho = scalebb(i, j, p_scbb_co)*temp30b
          temp29 = 60.*rho_phy(i, k, j)
          temp28 = temp29*dz8w(i, k, j)
          temp28b0 = -(r_q*4.828e-4*dtstep*a_conv_rho/temp28**2)
          a_rho_phy(i, k, j) = a_rho_phy(i, k, j) + dz8w(i, k, j)*60.*&
&            temp28b0
          a_dz8w(i, k, j) = a_dz8w(i, k, j) + temp29*temp28b0
          DO k=kte-1,kts+1,-1
            conv_rho = r_q*4.828e-4/rho_phy(i, k, j)*dtstep/60./dz8w(i, &
&              k, j)
            temp28b = ebu(i, k, j, p_ebu_co)*a_chem(i, k, j, &
&              p_tracer_1)
            a_scalebb(i, j, p_scbb_co) = a_scalebb(i, j, p_scbb_co) + &
&              conv_rho*temp28b
            a_conv_rho = scalebb(i, j, p_scbb_co)*temp28b
            temp27 = 60.*rho_phy(i, k, j)
            temp26 = temp27*dz8w(i, k, j)
            temp26b3 = -(r_q*4.828e-4*dtstep*a_conv_rho/temp26**2)
            a_rho_phy(i, k, j) = a_rho_phy(i, k, j) + dz8w(i, k, j)*60.*&
&              temp26b3
            a_dz8w(i, k, j) = a_dz8w(i, k, j) + temp27*temp26b3
          END DO
          CALL POPINTEGER4(k)
        END DO
      END DO
    CASE (GHG_TRACER) 
      IF (biomass_burn_opt .EQ. biomassb_ghg) THEN
        DO j=jte,jts,-1
          DO k=kte,kts,-1
            DO i=ite,its,-1
              temp32b1 = ebu(i, k, j, p_ebu_co)*a_chem(i, k, j, &
&                p_co_bbu)
              temp32b0 = ebu(i, k, j, p_ebu_co2)*a_chem(i, k, j, &
&                p_co2_bbu)
              conv_rho = r_q*4.828e-4/rho_phy(i, k, j)*dtstep/60./dz8w(i&
&                , k, j)
              temp32b = ebu(i, k, j, p_ebu_ch4)*a_chem(i, k, j, &
&                p_ch4_bbu)
              a_scalebb(i, j, p_scbb_ch4) = a_scalebb(i, j, p_scbb_ch4) &
&                + conv_rho*temp32b
              a_conv_rho = scalebb(i, j, p_scbb_co2)*temp32b0 + &
&                scalebb(i, j, p_scbb_co)*temp32b1 + scalebb(i, j, &
&                p_scbb_ch4)*temp32b
              a_scalebb(i, j, p_scbb_co2) = a_scalebb(i, j, p_scbb_co2) &
&                + conv_rho*temp32b0
              a_scalebb(i, j, p_scbb_co) = a_scalebb(i, j, p_scbb_co) + &
&                conv_rho*temp32b1
              temp31 = 60.*rho_phy(i, k, j)
              temp30 = temp31*dz8w(i, k, j)
              temp30b0 = -(r_q*4.828e-4*dtstep*a_conv_rho/temp30**2)
              a_rho_phy(i, k, j) = a_rho_phy(i, k, j) + dz8w(i, k, j)*&
&                60.*temp30b0
              a_dz8w(i, k, j) = a_dz8w(i, k, j) + temp31*temp30b0
            END DO
          END DO
        END DO
      END IF
    END SELECT
    CALL POPCONTROL2B(branch)
    IF (branch .EQ. 0) THEN
      DO j=jte,jts,-1
        DO i=ite,its,-1
          DO k=kte,kts,-1
            conv_rho = r_q*4.828e-4/rho_phy(i, k, j)*dtstep/(dz8w(i, k, &
&              j)*60.)
            temp1b = ebu(i, k, j, p_ebu_co)*a_chem(i, k, j, p_smoke)
            a_scalebb(i, j, p_scbb_co) = a_scalebb(i, j, p_scbb_co) + &
&              conv_rho*temp1b
            a_conv_rho = scalebb(i, j, p_scbb_co)*temp1b
            temp0 = 60.*rho_phy(i, k, j)
            temp = temp0*dz8w(i, k, j)
            tempb = -(r_q*4.828e-4*dtstep*a_conv_rho/temp**2)
            a_rho_phy(i, k, j) = a_rho_phy(i, k, j) + dz8w(i, k, j)*60.*&
&              tempb
            a_dz8w(i, k, j) = a_dz8w(i, k, j) + temp0*tempb
          END DO
        END DO
      END DO
    ELSE IF (branch .EQ. 1) THEN
      DO j=jte,jts,-1
        DO i=ite,its,-1
          DO k=kte,kts,-1
            temp3b0 = ebu(i, k, j, p_ebu_co)*a_chem(i, k, j, p_tr17_3)
            conv_rho = r_q*4.828e-4/rho_phy(i, k, j)*dtstep/(dz8w(i, k, &
&              j)*60.)
            temp3b = ebu(i, k, j, p_ebu_co)*a_chem(i, k, j, p_tr17_4)
            a_scalebb(i, j, p_scbb_co) = a_scalebb(i, j, p_scbb_co) + &
&              conv_rho*temp3b0 + conv_rho*temp3b
            a_conv_rho = scalebb(i, j, p_scbb_co)*temp3b0 + scalebb(i&
&              , j, p_scbb_co)*temp3b
            temp2 = 60.*rho_phy(i, k, j)
            temp1 = temp2*dz8w(i, k, j)
            temp1b0 = -(r_q*4.828e-4*dtstep*a_conv_rho/temp1**2)
            a_rho_phy(i, k, j) = a_rho_phy(i, k, j) + dz8w(i, k, j)*60.*&
&              temp1b0
            a_dz8w(i, k, j) = a_dz8w(i, k, j) + temp2*temp1b0
          END DO
        END DO
      END DO
    END IF
  END SUBROUTINE a_add_emis_burn

END MODULE a_module_add_emiss_burn
